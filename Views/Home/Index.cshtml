@using Instagram_Clone.Interface
@model List<Exercise>
@inject IAccountService _accountservice;
@{
    var LoggedInUser = await _accountservice.GetLoggedInUserAsync();
}
<style>
    .modal {
        display: none;
        position: fixed; 
        z-index: 9999;
        left: 50%;
        top: 50%; 
        transform: translate(-50%, -50%); 
        width: 400px; 
        height: 400px; 
        background-color: #fff; 
        border-radius: 10px; 
        padding: 20px; 
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .modal-content {
        position: relative; 
        height: 100%; 
    }

    .close {
        position: absolute; 
        top: 10px; 
        right: 10px; 
        cursor: pointer;
    }

    #exerciseResults {
        display: flex;
        flex-wrap: nowrap; /* Prevent wrapping onto multiple lines */
        overflow-x: auto; /* Enable horizontal scrolling */
        -webkit-overflow-scrolling: touch; /* Enable smooth scrolling on iOS */
    }

    /* Optional: Adjust styling for individual cards if needed */
    .exercise-card {
        flex: 0 0 auto; /* Prevent flex items from growing or shrinking */
        margin-right: 10px; /* Adjust spacing between cards */
    }
</style>

<div class="container-fluid mt-3">
    <input type="text" id="exerciseSearch" class="form-control mb-3" placeholder="Search exercises...">

    <div id="exerciseResults" class="d-flex flex-nowrap overflow-auto row  g-4 mt-3 position-relative" style="z-index:1000; color:red;">
        <!-- Exercise cards will be dynamically added here -->
    </div>
</div>

<div class="container-fluid mt-5 ">
    <div id="fitnessModal" class="modal">
        <form asp-action="SaveUserFitnessLevel" asp-controller="Exercise" method="post">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 class="mb-4">Select Your Fitness Level</h2>
                <div class="form-group">
                    @Html.DropDownListFor(model => model.First().ExerciseCategory, new SelectList(Enum.GetValues(typeof(Instagram_Clone.Models.ExerciseCategory))), new { @class = "form-control mb-3", id = "exerciseCategoryDropdown" })
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
        
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="welcome-message p-4">
                <h1 class="display-3">Welcome to <span class="text-danger">FitZone!</span></h1>
                <p class="lead mt-4">Get ready to embark on an exciting fitness journey with FitZone. Whether you're looking to build muscle, lose weight, or improve your overall health, we've got you covered. Our comprehensive range of workouts, nutrition plans, and expert guidance will help you reach your fitness goals effectively. Let's make every sweat count!</p>
                <button class="btn btn-primary mt-3" id="changeFitnessLevelBtn">Adjust Fitness Level</button>
                <br></br>
                <br />
                   
            </div>
        </div>
        <div class="col-lg-6">
            <img src="~/Images/AI_Generated_Image_2024-03-30_449516500002201.jpg" class="img-fluid rounded-3" style="object-fit:cover;" alt="Fitness Image">
        </div>

    </div>
    <div class="container-fluid mt-5">
        <h2 class="text-left mb-4">Exercises for you:</h2>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 mt-3">
            <!-- Adjusted margin top -->
            @foreach (var exercise in Model)
            {
                <div class="col">
                    <div class="card h-100 border-0 rounded-3 shadow position-relative">
                        <!-- Check if user has a subscription -->
                        @if (!LoggedInUser.HasSubscription && exercise.ExclusiveContent)
                        {
                            <!-- Subscription Card -->
                            <div class="position-absolute  start-50 translate-middle" style="z-index: 1000;top:30%">
                                <h2 class="text-center text-white">Exclusive Content</h2>
                                <a style="text-decoration:none;" asp-action="SubscriptionPage" asp-controller="Subscription">
                                    <button class="btn btn-danger d-block mx-auto mt-3">Subscribe</button>
                                </a>
                            </div>
                        }

                        @if (!LoggedInUser.HasSubscription && exercise.ExclusiveContent)
                        {
                            <img src="@exercise.ExerciseImage" height="220px" style="object-fit:cover; filter: blur(25px);" class="card-img-top" alt="@exercise.ExerciseName">
                        }
                        else
                        {
                            <img src="@exercise.ExerciseImage" height="220px" style="object-fit:cover;" class="card-img-top" alt="@exercise.ExerciseName">

                        }

                            
                            

                        <div class="card-body">
                            <p class="card-text">
                            </p>
                            @if (!LoggedInUser.HasSubscription && exercise.ExclusiveContent)
                            {
                                <a>
                                    <button disabled class="btn btn-primary">View Exercise</button>
                                </a>
                            }else

                            {
                            <a asp-action="ExerciseDetailsPage" asp-controller="Exercise" asp-route-ExerciseId="@exercise.Id">
                                <button  class="btn btn-primary">View Exercise</button>
                            </a>
                            }
                           
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>


    </div>





</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    var changeFitnessLevelBtn = document.getElementById("changeFitnessLevelBtn");
    var modal = document.getElementById("fitnessModal");
    var closeBtn = modal.querySelector(".close");

    
    changeFitnessLevelBtn.addEventListener("click", function () {
    modal.style.display = "block";
    });

    // Close modal when the close button is clicked
    closeBtn.addEventListener("click", function () {
    modal.style.display = "none";
    });

    // Remove "loggedIn" from localStorage when form is submitted
    var submitBtn = modal.querySelector(".btn-primary");
    submitBtn.onclick = function () {
    localStorage.removeItem("loggedIn");
    }
    });
    document.addEventListener("DOMContentLoaded", function () {
        var exerciseSearchInput = document.getElementById("exerciseSearch");
        var exerciseResultsContainer = document.getElementById("exerciseResults");

        exerciseSearchInput.addEventListener("input", function () {
            var searchQuery = exerciseSearchInput.value.toLowerCase();
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/Home/SearchExercises?query=" + searchQuery);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var exercises = JSON.parse(xhr.responseText);
                    displayExercises(exercises);
                }
            };
            xhr.send();
        });

        function displayExercises(exercises) {
            exerciseResultsContainer.innerHTML = "";

            var flexContainer = document.createElement('div');
            flexContainer.classList.add('d-flex', 'flex-wrap');

            exercises.forEach(function (exercise) {
                var cardHtml = '<div class="col-md-3 col-lg-2 mb-4">' + // Adjust column sizes as needed
                    '<div class="card border-0 rounded-3 shadow" style="height: 200px; margin-right: 10px;">' + // Set a fixed height for the card and add margin
                    '<img src="' + exercise.exerciseImage + '" class="card-img-top" style="object-fit: cover; height: 100%;" alt="' + exercise.exerciseName + '">' + // Exercise Image
                    '<div class="card-body d-flex justify-content-center align-items-center">' +
                    '<a href="/Exercise/ExerciseDetailsPage/' + exercise.Id + '" class="btn btn-primary">View More</a>' + // Dynamically generate link
                    '</div>' +
                    '</div>' +
                    '</div>';
                flexContainer.insertAdjacentHTML("beforeend", cardHtml);
            });




            exerciseResultsContainer.appendChild(flexContainer);
        }

    });
</script>



